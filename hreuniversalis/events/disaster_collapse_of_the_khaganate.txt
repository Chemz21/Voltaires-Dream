namespace = collapse_of_the_khaganate

country_event = {
	id = collapse_of_the_khaganate.1
	title = collapse_of_the_khaganate.1.t
	desc = collapse_of_the_khaganate.1.d
	picture = {
		trigger = { NOT = { has_dlc = "Star and Crescent" } }
		picture = COUNTRY_COLLAPSE_eventPicture
	}
	picture = {
		trigger = { has_dlc = "Star and Crescent" }
		picture = muslimgfx_COUNTRY_COLLAPSE_eventPicture
	}

	is_triggered_only = yes
	major = yes

	immediate = {
		hidden_effect = {
			set_country_flag = had_collapse_of_the_khaganate
			fragment_mongolia_effect = yes
			random_owned_province = {
				limit = { NOT = { controlled_by = REB } }
				spawn_rebels = {
					size = 6
					type = nationalist_rebels
					win = yes
				}
			}
			random_owned_province = {
				limit = { NOT = { controlled_by = REB } }
				spawn_rebels = {
					size = 6
					type = nationalist_rebels
					win = yes
				}
			}
			random_owned_province = {
				limit = { NOT = { controlled_by = REB } }
				spawn_rebels = {
					size = 6
					type = nationalist_rebels
					win = yes
				}
			}
			random_owned_province = {
				limit = { NOT = { controlled_by = REB } }
				spawn_rebels = {
					size = 6
					type = nationalist_rebels
					win = yes
				}
			}
			random_owned_province = {
				limit = { NOT = { controlled_by = REB } }
				spawn_rebels = {
					size = 6
					type = nationalist_rebels
					win = yes
				}
			}
		}
	}
	
	option = {
		name = collapse_of_the_khaganate.1.a
		add_stability = -5
		add_army_tradition = -25
		add_army_professionalism = -0.25
		if = {
			limit = { has_country_modifier = invasion_nation_m }
			remove_country_modifier = invasion_nation_m
		}
	}
}

#Trade Disputes
country_event = {
	id = collapse_of_the_khaganate.2
	title = collapse_of_the_khaganate.2.t
	desc = collapse_of_the_khaganate.2.d
	picture = {
		trigger = { NOT = { has_dlc = "Star and Crescent" } }
		picture = CIVIL_WAR_eventPicture
	}
	picture = {
		trigger = { has_dlc = "Star and Crescent" }
		picture = muslimgfx_CIVIL_WAR_eventPicture
	}

	is_triggered_only = yes

	trigger = {
		NOT = { has_country_modifier = mongol_trade_disputes }
	}

	option = {
		name = collapse_of_the_khaganate.2.a
		add_mercantilism = -5
		add_disaster_modifier = {
			name = mongol_trade_disputes
			duration = -1
			disaster = collapse_of_the_khaganate
		}
	}
}

#Decline of Warfare
country_event = {
	id = collapse_of_the_khaganate.3
	title = collapse_of_the_khaganate.3.t
	desc = collapse_of_the_khaganate.3.d
	picture = {
		trigger = { NOT = { has_dlc = "Star and Crescent" } }
		picture = WOUNDED_SOLDIERS_eventPicture
	}
	picture = {
		trigger = { has_dlc = "Star and Crescent" }
		picture = muslimgfx_WOUNDED_SOLDIERS_eventPicture
	}

	is_triggered_only = yes

	trigger = {
		NOT = { has_country_modifier = mongol_declining_warfare }
	}

	option = {
		name = collapse_of_the_khaganate.3.a
		add_army_tradition = -25
		add_disaster_modifier = {
			name = mongol_declining_warfare
			duration = -1
			disaster = collapse_of_the_khaganate
		}
	}
}

#Rising Corruption
country_event = {
	id = collapse_of_the_khaganate.4
	title = collapse_of_the_khaganate.4.t
	desc = collapse_of_the_khaganate.4.d
	picture = {
		trigger = { NOT = { has_dlc = "Star and Crescent" } }
		picture = CORRUPTION_eventPicture
	}
	picture = {
		trigger = { has_dlc = "Star and Crescent" }
		picture = muslimgfx_CORRUPTION_eventPicture
	}

	is_triggered_only = yes

	option = {
		name = collapse_of_the_khaganate.4.a
		add_corruption = 0.25
		add_years_of_income = -0.25
	}
	option = {
		name = collapse_of_the_khaganate.4.b
		add_adm_power = -50
	}
}

#Diplomatic Termination
country_event = {
	id = collapse_of_the_khaganate.5
	title = collapse_of_the_khaganate.5.t
	desc = collapse_of_the_khaganate.5.d
	picture = {
		trigger = { NOT = { has_dlc = "Star and Crescent" } }
		picture = BAD_WITH_MONARCH_eventPicture
	}
	picture = {
		trigger = { has_dlc = "Star and Crescent" }
		picture = muslimgfx_BAD_WITH_MONARCH_eventPicture
	}

	is_triggered_only = yes

	option = {
		name = collapse_of_the_khaganate.5.a
		if = {
			limit = {
				any_subject_country = {
					NOT = {
						has_opinion_modifier = {
							who = ROOT
							modifier = opinion_displeased
						}
					}
				}
			}
			random_subject_country = {
				limit = {
					NOT = {
						has_opinion_modifier = {
							who = ROOT
							modifier = opinion_displeased
						}
					}
				}
				add_opinion = {
					who = ROOT
					modifier = opinion_displeased
				}
				add_trust = {
					who = ROOT
					value = -10
				}
			}
		}
		else_if = {
			limit = {
				any_ally = {
					NOT = {
						has_opinion_modifier = {
							who = ROOT
							modifier = opinion_displeased
						}
					}
				}
			}
			random_ally = {
				limit = {
					NOT = {
						has_opinion_modifier = {
							who = ROOT
							modifier = opinion_displeased
						}
					}
				}
				add_opinion = {
					who = ROOT
					modifier = opinion_displeased
				}
				add_trust = {
					who = ROOT
					value = -10
				}
			}
		}
		else = {
			random_neighbor_country = {
				add_opinion = {
					who = ROOT
					modifier = opinion_displeased
				}
				add_trust = {
					who = ROOT
					value = -10
				}
			}
		}
	}
	option = {
		name = collapse_of_the_khaganate.5.b
		add_dip_power = -50
	}
}

#Social Unrest
country_event = {
	id = collapse_of_the_khaganate.6
	title = collapse_of_the_khaganate.6.t
	desc = collapse_of_the_khaganate.6.d
	picture = {
		trigger = { NOT = { has_dlc = "Star and Crescent" } }
		picture = RELIGIOUS_TURMOIL_eventPicture
	}
	picture = {
		trigger = { has_dlc = "Star and Crescent" }
		picture = muslimgfx_RELIGIOUS_TURMOIL_eventPicture
	}

	is_triggered_only = yes

	trigger = {
		any_owned_province = {
			NOT = { controlled_by = REB }
		}
	}

	immediate = {
		hidden_effect = {
			random_owned_province = {
				limit = { NOT = { controlled_by = REB } }
				save_event_target_as = nat_prov
			}
		}
	}

	option = {
		name = collapse_of_the_khaganate.6.a
		goto = nat_prov
		event_target:nat_prov = {
			spawn_rebels = {
				type = nationalist_rebels
				size = 4
				win = yes
			}
		}
	}
	option = {
		name = collapse_of_the_khaganate.6.b
		add_mil_power = -50
	}
}

#Ruler is captured
country_event = {
	id = collapse_of_the_khaganate.7
	title = collapse_of_the_khaganate.7.t
	desc = collapse_of_the_khaganate.7.d
	picture = {
		trigger = { NOT = { has_dlc = "Star and Crescent" } }
		picture = BATTLE_eventPicture
	}
	picture = {
		trigger = { has_dlc = "Star and Crescent" }
		picture = muslimgfx_BATTLE_eventPicture
	}

	is_triggered_only = yes

	trigger = {
		NOT = { has_country_flag = ruler_was_captured_flag }
	}

	immediate = {
		hidden_effect = {
			set_country_flag = ruler_was_captured_flag
		}
	}

	option = {
		name = collapse_of_the_khaganate.7.a
		add_years_of_income = -0.5
		change_adm = -1
		change_dip = -1
		change_mil = -1
	}
	option = {
		name = collapse_of_the_khaganate.7.b
		trigger = { heir_age = 15 }
		add_prestige = -10
		kill_ruler = yes
	}
	option = {
		name = collapse_of_the_khaganate.7.c
		trigger = { NOT = { heir_age = 15 } }
		add_stability = -1
		add_prestige = -25
		define_ruler = { hide_skills = yes }
		if = {
			limit = { has_heir = yes }
			remove_heir = {}
		}
	}
}

#Rise of Successor State
country_event = {
	id = collapse_of_the_khaganate.8
	title = collapse_of_the_khaganate.8.t
	desc = collapse_of_the_khaganate.8.d
	picture = {
		trigger = { NOT = { has_dlc = "Star and Crescent" } }
		picture = BATTLE_eventPicture
	}
	picture = {
		trigger = { has_dlc = "Star and Crescent" }
		picture = muslimgfx_CIVIL_WAR_eventPicture
	}

	is_triggered_only = yes

	trigger = {
		OR = {
			AND = {
				NOT = { exists = GOL }
				GOL = { NOT = { has_country_flag = mongol_secession_flag } }
				num_of_owned_provinces_with = {
					value = 10
					is_core = GOL
					controlled_by = REB
				}
			}
			AND = {
				NOT = { exists = CRI }
				CRI = { NOT = { has_country_flag = mongol_secession_flag } }
				num_of_owned_provinces_with = {
					value = 10
					is_core = CRI
					controlled_by = REB
				}
			}
			AND = {
				NOT = { exists = KAZ }
				KAZ = { NOT = { has_country_flag = mongol_secession_flag } }
				num_of_owned_provinces_with = {
					value = 10
					is_core = KAZ
					controlled_by = REB
				}
			}
			AND = {
				NOT = { exists = NOG }
				NOG = { NOT = { has_country_flag = mongol_secession_flag } }
				num_of_owned_provinces_with = {
					value = 10
					is_core = NOG
					controlled_by = REB
				}
			}
			AND = {
				NOT = { exists = AST }
				AST = { NOT = { has_country_flag = mongol_secession_flag } }
				num_of_owned_provinces_with = {
					value = 10
					is_core = AST
					controlled_by = REB
				}
			}
			AND = {
				NOT = { exists = JYA }
				JYA = { NOT = { has_country_flag = mongol_secession_flag } }
				num_of_owned_provinces_with = {
					value = 10
					is_core = JYA
					controlled_by = REB
				}
			}
			AND = {
				NOT = { exists = AKK }
				AKK = { NOT = { has_country_flag = mongol_secession_flag } }
				num_of_owned_provinces_with = {
					value = 10
					is_core = AKK
					controlled_by = REB
				}
			}
			AND = {
				NOT = { exists = QAR }
				QAR = { NOT = { has_country_flag = mongol_secession_flag } }
				num_of_owned_provinces_with = {
					value = 10
					is_core = QAR
					controlled_by = REB
				}
			}
		}		
	}

	immediate = {
		hidden_effect = {
			if = {
				limit = {
					NOT = { exists = GOL }
					GOL = { NOT = { has_country_flag = mongol_secession_flag } }
					num_of_owned_provinces_with = {
						value = 10
						is_core = GOL
						controlled_by = REB
					}
				}
				GOL = {
					save_event_target_as = mongol_secession_tag
					set_country_flag = mongol_secession_flag
				}
			}
			else_if = {
				limit = {
					NOT = { exists = CRI }
					CRI = { NOT = { has_country_flag = mongol_secession_flag } }
					num_of_owned_provinces_with = {
						value = 10
						is_core = CRI
						controlled_by = REB
					}
				}
				CRI = {
					save_event_target_as = mongol_secession_tag
					set_country_flag = mongol_secession_flag
				}
			}
			else_if = {
				limit = {
					NOT = { exists = KAZ }
					KAZ = { NOT = { has_country_flag = mongol_secession_flag } }
					num_of_owned_provinces_with = {
						value = 10
						is_core = KAZ
						controlled_by = REB
					}
				}
				KAZ = {
					save_event_target_as = mongol_secession_tag
					set_country_flag = mongol_secession_flag
				}
			}
			else_if = {
				limit = {
					NOG = { NOT = { has_country_flag = mongol_secession_flag } }
					num_of_owned_provinces_with = {
						value = 10
						is_core = NOG
						controlled_by = REB
					}
				}
				NOG = {
					save_event_target_as = mongol_secession_tag
					set_country_flag = mongol_secession_flag
				}
			}
			else_if = {
				limit = {
					NOT = { exists = AST }
					AST = { NOT = { has_country_flag = mongol_secession_flag } }
					num_of_owned_provinces_with = {
						value = 10
						is_core = AST
						controlled_by = REB
					}
				}
				AST = {
					save_event_target_as = mongol_secession_tag
					set_country_flag = mongol_secession_flag
				}
			}
			else_if = {
				limit = {
					NOT = { exists = JYA }
					JYA = { NOT = { has_country_flag = mongol_secession_flag } }
					num_of_owned_provinces_with = {
						value = 10
						is_core = JYA
						controlled_by = REB
					}
				}
				JYA = {
					save_event_target_as = mongol_secession_tag
					set_country_flag = mongol_secession_flag
				}
			}
			else_if = {
				limit = {
					NOT = { exists = AKK }
					AKK = { NOT = { has_country_flag = mongol_secession_flag } }
					num_of_owned_provinces_with = {
						value = 10
						is_core = AKK
						controlled_by = REB
					}
				}
				AKK = {
					save_event_target_as = mongol_secession_tag
					set_country_flag = mongol_secession_flag
				}
			}
			else_if = {
				limit = {
					NOT = { exists = QAR }
					QAR = { NOT = { has_country_flag = mongol_secession_flag } }
					num_of_owned_provinces_with = {
						value = 10
						is_core = QAR
						controlled_by = REB
					}
				}
				QAR = {
					save_event_target_as = mongol_secession_tag
					set_country_flag = mongol_secession_flag
				}
			}
		}
	}

	option = {
		name = collapse_of_the_khaganate.8.a
		ai_chance = { factor = 1 }
		hidden_effect = {
			every_owned_province = {
				limit = { is_core = event_target:mongol_secession_tag }
				clear_rebels = yes
			}
		}
		release = event_target:mongol_secession_tag
		create_march = event_target:mongol_secession_tag
		add_horde_unity = -10
		add_legitimacy = -10
		hidden_effect = {
			event_target:mongol_secession_tag = {
				change_government = tribal
				if = {
					limit = { tag = GOL }
					define_ruler = { dynasty = "Borjigin" }
					add_government_reform = steppe_horde
					change_religion = tengri_pagan_reformed
				}
				else_if = {
					limit = { tag = CRI }
					define_ruler = { dynasty = "Borjigin" }
					add_government_reform = steppe_horde
					change_religion = tengri_pagan_reformed
				}
				else_if = {
					limit = { tag = KAZ }
					define_ruler = { dynasty = "Borjigin" }
					add_government_reform = steppe_horde
					change_religion = tengri_pagan_reformed
				}
				else_if = {
					limit = { tag = NOG }
					define_ruler = { dynasty = "Manghut" }
					add_government_reform = steppe_horde
					change_religion = tengri_pagan_reformed
				}
				else_if = {
					limit = { tag = AST }
					define_ruler = { dynasty = "Borjigin" }
					add_government_reform = steppe_horde
					change_religion = tengri_pagan_reformed
				}
				else_if = {
					limit = { tag = JYA }
					define_ruler = { dynasty = "Jalair" }
					add_government_reform = tribal_federation
					change_religion = sunni
				}
				else_if = {
					limit = { tag = AKK }
					define_ruler = { dynasty = "Aq Qoyunlu" }
					add_government_reform = tribal_federation
					change_religion = sunni
				}
				else_if = {
					limit = { tag = QAR }
					define_ruler = { dynasty = "Qara Qoyunlu" }
					add_government_reform = tribal_federation
					change_religion = sunni
				}
				embrace_institutions_of = ROOT
				adopt_reform_progress = ROOT
				add_manpower = 25
				add_treasury = 250
				add_prestige = 25
				capital_scope = {
					build_to_forcelimit = {
						infantry = 0.7
						cavalry = 0.3
					}
				}
			}
		}
	}
	option = {
		name = collapse_of_the_khaganate.8.b
		ai_chance = { factor = 0 }
		add_horde_unity = 10
		add_legitimacy = 10
		random_owned_province = {
			limit = {
				controlled_by = REB
				is_core = event_target:mongol_secession_tag
			}
			spawn_rebels = {
				friend = event_target:mongol_secession_tag
				size = 4
			}
		}
		random_owned_province = {
			limit = {
				controlled_by = REB
				is_core = event_target:mongol_secession_tag
			}
			spawn_rebels = {
				friend = event_target:mongol_secession_tag
				size = 4
			}
		}
		random_owned_province = {
			limit = {
				controlled_by = REB
				is_core = event_target:mongol_secession_tag
			}
			spawn_rebels = {
				friend = event_target:mongol_secession_tag
				size = 4
			}
		}
	}
}

#Advisor Poisoned
country_event = {
	id = collapse_of_the_khaganate.9
	title = collapse_of_the_khaganate.9.t
	desc = collapse_of_the_khaganate.9.d

	is_triggered_only = yes

	trigger = {
		has_advisor = yes
	}

	option = {
		name = collapse_of_the_khaganate.9.a
		if = {
			limit = { has_mil_advisor = yes }
			kill_advisor_by_category_effect = mil
		}
		else_if = {
			limit = { has_adm_advisor = yes }
			kill_advisor_by_category_effect = adm
		}
		else = {
			kill_advisor_by_category_effect = dip
		}
		add_years_of_income = -0.15
	}

	option = {
		name = collapse_of_the_khaganate.9.b
		if = {
			limit = { has_mil_advisor = yes }
			kill_advisor_by_category_effect = mil
		}
		else_if = {
			limit = { has_adm_advisor = yes }
			kill_advisor_by_category_effect = adm
		}
		else = {
			kill_advisor_by_category_effect = dip
		}
		add_prestige = -10
	}
}

country_event = {
	id = collapse_of_the_khaganate.100
	title = collapse_of_the_khaganate.100.t
	desc = collapse_of_the_khaganate.100.d
	picture = {
		trigger = { NOT = { has_dlc = "Star and Crescent" } }
		picture = OVEREXTENSION_eventPicture
	}
	picture = {
		trigger = { has_dlc = "Star and Crescent" }
		picture = muslimgfx_OVEREXTENSION_eventPicture
	}

	is_triggered_only = yes
	major = yes

	option = {
		name = collapse_of_the_khaganate.100.a
		clr_country_flag = ruler_was_captured_flag
		add_stability = 1
		add_horde_unity = 25
		add_legitimacy = 25
		add_republican_tradition = 25
		add_devotion = 25
	}
}