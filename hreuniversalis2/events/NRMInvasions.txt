#Norman Invasion Events

namespace = nrm_invasions

#Ireland chain

#Opening - Strongbow
country_event = {
	id = nrm_invasions.1
	title = nrm_invasions.1.t
	desc = nrm_invasions.1.d
	picture = DIPLOMACY_eventPicture

	fire_only_once = yes

	trigger = {
		tag = ENG
		current_age = age_of_holy_wars
		NOT = { started_in = 1169.1.1 }
		OR = {
			LEI = {
				OR = {
					primary_culture = dalcassian
					primary_culture = eoganachta
					primary_culture = laigin
					primary_culture = irish
					primary_culture = erainn
					primary_culture = ulaidh
					primary_culture = connachta
					primary_culture = gallowglass
				}
				is_subject = no
				ai = yes
				any_owned_province = {
					region = ireland_region
					has_port = yes
				}
				#add - Is NOT High King
			}
			any_known_country = {
				OR = {
					primary_culture = dalcassian
					primary_culture = eoganachta
					primary_culture = laigin
					primary_culture = irish
					primary_culture = erainn
					primary_culture = ulaidh
					primary_culture = connachta
					primary_culture = gallowglass
				}
				is_subject = no
				ai = yes
				any_owned_province = {
					region = ireland_region
					has_port = yes
				}
				#add - Is NOT High King
			}
		}
	}

	mean_time_to_happen = {
		months = 240
	}

	immediate = {
		if = {
			limit = {
				LEI = {
					OR = {
						primary_culture = dalcassian
						primary_culture = eoganachta
						primary_culture = laigin
						primary_culture = irish
						primary_culture = erainn
						primary_culture = ulaidh
						primary_culture = connachta
						primary_culture = gallowglass
					}
					is_subject = no
					ai = yes
					any_owned_province = {
						region = ireland_region
						has_port = yes
					}
					#add - Is NOT High King
				}
			}
			LEI = {
				save_event_target_as = irish_invasion_tag
			}
		}
		else = {
			random_known_country = {
				limit = {
					OR = {
						primary_culture = dalcassian
						primary_culture = eoganachta
						primary_culture = laigin
						primary_culture = irish
						primary_culture = erainn
						primary_culture = ulaidh
						primary_culture = connachta
						primary_culture = gallowglass
					}
					is_subject = no
					ai = yes
					any_owned_province = {
						region = ireland_region
						has_port = yes
					}
					#add - Is NOT High King
				}
				save_event_target_as = irish_invasion_tag
			}
		}
		
	}

	option = {	#Accept support
		name = nrm_invasions.1.a
		ai_chance = { 
			factor = 90 
			#add modifiers
		}
		add_treasury = -50
		event_target:irish_invasion_tag = {
			define_general = {
				name = "Strongbow"
				fire = 4
				shock = 5
				manuever = 1
				siege = 0
			}
			random_owned_province = {
				limit = { controlled_by = PREV }
				build_to_forcelimit = {
					infantry = 0.7
					cavalry = 0.3
				}
			}
			set_country_flag = irish_invasion_flag
		}
		#add - High King declares war on this tag
	}
	option = {	#Decline support
		name = nrm_invasions.1.b
		ai_chance = { 
			factor = 10 
			#add modifiers
		}
		add_prestige = -10
		#add - High King declares war on this tag
	}
}

#Strongbow becomes ruler
country_event = {
	id = nrm_invasions.2
	title = nrm_invasions.2.t
	desc = {
		trigger = { has_leader = "Strongbow" }
		desc = nrm_invasions.2.da
	}
	desc = {
		trigger = { NOT = { has_leader = "Strongbow" } }
		desc = nrm_invasions.2.db
	}
	picture = DEATH_OF_HEIR_eventPicture

	is_triggered_only = yes
	fire_only_once = yes
	major = yes

	trigger = {
		has_country_flag = irish_invasion_flag
	}

	immediate = {
		hidden_effect = {
			ENG = {
				save_event_target_as = norman_culture_scope
			}
			set_saved_name = {
				key = strongbow_heir
				type = advisor
				scope = event_target:norman_culture_scope
			}
			set_saved_name = {
				key = strongbow_other_ruler
				type = advisor
				scope = event_target:norman_culture_scope
			}
		}	
	}

	option = {
		name = nrm_invasions.2.a
		ai_chance = { factor = 100 }
		if = {
			limit = { has_leader = "Strongbow" }
			hidden_effect = {
				kill_leader = {
					type = "Strongbow"
				}
			}
			define_ruler = {
				name = "Richard I"
				dynasty = "de Clare"
				culture = english
				adm = 5
				dip = 5
				mil = 6
				fixed = yes
			}
			define_ruler_to_general = {
				fire = 4
				shock = 5
				manuever = 1
				siege = 0
			}
		}
		else = {
			define_ruler = {
				name = strongbow_other_ruler
				dynasty = "de Clare"
				culture = english
			}
		}
		change_primary_culture = hiberno_norman
		add_accepted_culture = irish
		change_government = monarchy
		add_government_reform = feudalism_reform
		define_heir = {
			name = strongbow_heir
			dynasty = "de Clare"
			culture = hiberno_norman
		}
		clr_country_flag = irish_invasion_flag
		custom_tooltip = nrm_invasions.2.a.tt
		set_global_flag = norman_invasion_started
	}
	after = {
		if = {
			limit = {
				has_ruler = "Richard I"
			}
			add_ruler_personality = intricate_web_weaver_personality
			add_ruler_personality = conqueror_personality
		}
	}
}

#Norman invasion of ROOT
country_event = {
	id = nrm_invasions.3
	title = nrm_invasions.3.t
	desc = nrm_invasions.3.d
	picture = BORDER_TENSION_eventPicture

	trigger = {
		has_global_flag = norman_invasion_started
		NOT = { 
			had_global_flag = {
				flag = norman_invasion_started 
				days = 18250
			}
		}
		NOT = { 
			OR = {
				primary_culture = hiberno_norman
				has_country_flag = refused_norman_ruler
			}
		}
		capital_scope = { superregion = irish_superregion }
		OR = {
			primary_culture = dalcassian
			primary_culture = eoganachta
			primary_culture = laigin
			primary_culture = irish
			primary_culture = erainn
			primary_culture = ulaidh
			primary_culture = connachta
			primary_culture = gallowglass
		}
		any_neighbor_country = {
			primary_culture = hiberno_norman
		}
		is_subject = no
		#add - Is NOT High King
	}

	mean_time_to_happen = {
		months = 120
	}

	immediate = {
		hidden_effect = {
			ENG = {
				save_event_target_as = norman_culture_scope
			}
			set_saved_name = {
				key = norman_invasion_heir
				type = advisor
				scope = event_target:norman_culture_scope
			}
			set_saved_name = {
				key = norman_invasion_heir2
				type = advisor
				scope = event_target:norman_culture_scope
			}
			if = {
				limit = { has_heir = yes }
				exile_heir_as = norman_invasion_former_heir
			}
		}
	}

	option = {	#Accept Norman ruler
		name = nrm_invasions.3.a
		ai_chance = { 
			factor = 25
		}
		change_primary_culture = hiberno_norman
		add_accepted_culture = irish
		change_government = monarchy
		add_government_reform = feudalism_reform
		custom_tooltip = nrm_invasions.3.a.tt
		custom_tooltip = nrm_invasions.3.a.tt2
		hidden_effect = {
			define_ruler = {
				name = norman_invasion_heir
				age = 18
				culture = english
			}
		}
		add_truce_with = ENG
	}
	option = {	#Fight Norman ruler
		name = nrm_invasions.3.b
		ai_chance = { 
			factor = 75
			modifier = {
				factor = 0.25
				is_at_war = yes
			}
			modifier = {
				factor = 1.25
				ruler_has_personality = fierce_negotiator_personality
			}
			modifier = {
				factor = 0.5
				num_of_rebel_controlled_provinces = 1
			}
			modifier = {
				factor = 0.75
				num_of_loans = 1
			}
			modifier = {
				factor = 0.5
				NOT = { stability = 0 }
			}
		}
		add_stability = -1
		set_country_flag = refused_norman_ruler
		hidden_effect = {
			define_heir = {
				name = norman_invasion_heir
				age = 18
				culture = english
			}
		}
		random_owned_province = {
			limit = { superregion = irish_superregion }
			spawn_rebels = {
				type = pretender_rebels
				use_heir_as_leader = yes
				size = 2
				friend = ENG
				culture = english
			}
		}
	}
	after = {
		if = {
			limit = { primary_culture = hiberno_norman }
			define_heir = {
				name = norman_invasion_heir2
				age = 0
				dynasty = ROOT
				culture = hiberno_norman
			}
		}
		else_if = {
			limit = { 
				has_country_flag = refused_norman_ruler
				has_heir = yes 
			}
			set_heir = norman_invasion_former_heir
		}
	}
}

#On pretenders win
country_event = {
	id = nrm_invasions.4
	title = nrm_invasions.4.t
	desc = nrm_invasions.4.d
	picture = BAD_WITH_MONARCH_eventPicture

	is_triggered_only = yes

	trigger = {
		ruler_culture = english
		has_country_flag = refused_norman_ruler
		capital_scope = { superregion = irish_superregion }
		OR = {
			primary_culture = dalcassian
			primary_culture = eoganachta
			primary_culture = laigin
			primary_culture = irish
			primary_culture = erainn
			primary_culture = ulaidh
			primary_culture = connachta
			primary_culture = gallowglass
		}
		has_global_flag = norman_invasion_started
	}

	option = {
		name = nrm_invasions.4.a
		ai_chance = { factor = 100 }
		change_primary_culture = hiberno_norman
		add_accepted_culture = irish
		change_government = monarchy
		add_government_reform = feudalism_reform
		add_stability = 1
		clr_country_flag = refused_norman_ruler
		define_heir = {
			name = norman_invasion_heir2
			age = 0
			dynasty = ROOT
			culture = hiberno_norman
		}
		add_truce_with = ENG
	}
}

#Pale establishment event
country_event = {
	id = nrm_invasions.5
	title = nrm_invasions.5.t
	desc = nrm_invasions.5.d
	picture = HARBOUR_eventPicture

	fire_only_once = yes

	trigger = {
		tag = ENG
		any_known_country = {
			primary_culture = hiberno_norman
			capital_scope = { superregion = irish_superregion }
			owns = 2737
		}
		has_global_flag = norman_invasion_started
	}

	mean_time_to_happen = {
		months = 240
	}

	immediate = {
		hidden_effect = {
			random_known_country = {
				limit = {
					primary_culture = hiberno_norman
					capital_scope = { superregion = irish_superregion }
					owns = 2737
				}
				save_event_target_as = pale_owner_country
			}
		}
	}

	option = {	#Annex the Pale
		name = nrm_invasions.5.a
		ai_chance = { 
			factor = 50 
			#add modifiers
		}
		add_adm_power = -50
		add_treasury = -100
		2737 = {
			if = {
				limit = {
					owned_by = event_target:pale_owner_country
				}
				remove_core = event_target:pale_owner_country
				cede_province = ROOT
				add_core = ROOT
			}
		}
		4729 = {
			if = {
				limit = {
					owned_by = event_target:pale_owner_country
				}
				remove_core = event_target:pale_owner_country
				cede_province = ROOT
				add_core = ROOT
			}
		}
		2622 = {
			if = {
				limit = {
					owned_by = event_target:pale_owner_country
				}
				remove_core = event_target:pale_owner_country
				cede_province = ROOT
				add_core = ROOT
			}
		}
		add_truce_with = event_target:pale_owner_country
	}
	option = {	#Leave Irish to govern
		name = nrm_invasions.5.b
		ai_chance = { 
			factor = 50 
			#add modifiers
		}
		add_prestige = -10
		add_truce_with = event_target:pale_owner_country
	}
}

#Statutes of Kilkenny
country_event = {
	id = nrm_invasions.6
	title = nrm_invasions.6.t
	desc = nrm_invasions.6.d
	picture = REFORM_eventPicture

	fire_only_once = yes

	trigger = {
		tag = ENG
		has_global_flag = norman_invasion_started
		OR = {
			num_of_provinces_owned_or_owned_by_non_sovereign_subjects_with = {
				value = 5
				superregion = irish_superregion
			}
			any_known_country = {
				primary_culture = hiberno_norman
				capital_scope = { superregion = irish_superregion }
			}
		}
		current_age = age_of_dynasticism
	}

	mean_time_to_happen = {
		months = 240
	}

	option = {	#Make the Statutes law
		name = nrm_invasions.6.a
		ai_chance = { 
			factor = 75
			#add modifiers
		}
		custom_tooltip = nrm_invasions.6.a.tt
		hidden_effect = {
			every_known_country = {
				limit = { 
					primary_culture = hiberno_norman
					capital_scope = { superregion = irish_superregion }
				}
				country_event = {
					id = nrm_invasions.7
					days = 30
					random = 10
				}
			}
		}
	}
	option = {	#Leave it
		name = nrm_invasions.6.b
		ai_chance = { 
			factor = 25
			#add modifiers
		}
		add_prestige = -10
	}
}

#Statutes of Kilkenny for Norman tags
country_event = {
	id = nrm_invasions.7
	title = nrm_invasions.7.t
	desc = nrm_invasions.7.d
	picture = REFORM_eventPicture

	is_triggered_only = yes

	option = {
		name = nrm_invasions.7.a
		ai_chance = { factor = 100 }
		add_country_modifier = {
			name = "kilkennystatutesmod"
			duration = -1
		}
	}
}