#Andalusian missions
#Designed by RetrogMGXII
#Coded by ShyGuy13

vn_taifa_missions_slot_2_b = {
    slot = 7
    generic = no
    ai = yes
    potential = {
		OR = { 
			tag = ADU
            AND = {
                capital_scope = {
                    superregion = iberia_superregion
                }
                religion_group = muslim
                OR = {
                    primary_culture = andalucian
                    primary_culture = mozarabic
                }
            }
        }
        NOT = { map_setup = map_setup_random }
    }
    has_country_shield = yes

    vn_taifa_humiliate_rivals = {
        position = 3
        icon = mission_el_badi_palace
        required_missions = { vn_taifa_continue_the_fitna }
        provinces_to_highlight = {
            owner = {
                is_enemy = ROOT
                OR = {
                    NOT = {
                        OR = {
                            has_opinion_modifier = {
                                who = ROOT
                                modifier = insulted
                            }
                            has_opinion_modifier = {
                                who = ROOT
                                modifier = scornfully_insulted
                            }
                        }
                    }
                    NOT = {
                        ROOT = {
                            has_won_war_against = {
                                who = PREV
                                max_years_since = 20
                            }
                        }
                    }
                }
            }
        }
        trigger = {
            power_projection = 25
            custom_trigger_tooltip = {
                tooltip = vn_taifa_humiliate_rivals.tt
                any_country = {
                    is_enemy = ROOT
                }
                all_rival_country = {
                    OR = {
                        custom_trigger_tooltip = {
                            tooltip = has_been_insulted_by_root
                            OR = {
                                has_opinion_modifier = {
                                    who = ROOT
                                    modifier = insulted
                                }
                                has_opinion_modifier = {
                                    who = ROOT
                                    modifier = scornfully_insulted
                                }
                            }
                        }
                        ROOT = {
                            has_won_war_against = {
                                who = PREV
                                max_years_since = 20
                            }
                        }
                    }
                }
            }
        }
        effect = {
            add_country_modifier = {
                name = taifa_humiliate_rivals_mission
                duration = 9125
            }
        }
    }
    vn_taifa_spoils_of_war = {
        position = 4
        icon = mission_zambezi_gold
        required_missions = { vn_taifa_humiliate_rivals }
        trigger = {
            treasury = 500
            if = {
                limit = { has_dlc = "Art of War" }
                num_of_war_reparations = 3
            }
            else = {
                share_of_starting_income = 5
            }
            NOT = { num_of_loans = 1 }
        }
        effect = {
            if = {
                limit = { has_dlc = "Art of War" }
                custom_tooltip = vn_taifa_spoils_of_war.tt
                hidden_effect = {
                    if = {
                        limit = { num_of_war_reparations = 5 }
                        add_treasury = 250
                    }
                    else_if = {
                        limit = { num_of_war_reparations = 4 }
                        add_treasury = 200
                    }
                    else = {
                        add_treasury = 150
                    }
                }
            }
            else = {
                add_treasury = 200
            }
        }
    }
    vn_taifa_university_of_cordoba = {
        position = 5
        icon = mission_develop_cordoba
        required_missions = { vn_taifa_spoils_of_war vn_taifa_restore_cordoba }
        provinces_to_highlight = {
            province_id = 2670
        }
        trigger = {
            2670 = {
                owned_by = ROOT
                development = 30
                if = {
                    limit = { has_dlc = "Dharma" }
                    province_has_center_of_trade_of_level = 3
                }
                num_of_buildings_in_province = 4
            }
        }
        effect = {
            change_innovativeness = 3
            2670 = {
                add_province_modifier = {
                    name = taifa_university_of_cordoba_mission
                    duration = -1
                }
            }
        }
    }
}


vn_adu_missions_slot_3 = {
    slot = 8
    generic = no
    ai = yes
    potential = {
		OR = { 
			tag = ADU
            AND = {
                capital_scope = {
                    superregion = iberia_superregion
                }
                religion_group = muslim
                OR = {
                    primary_culture = andalucian
                    primary_culture = mozarabic
                }
            }
        }
        NOT = { map_setup = map_setup_random }
    }
    has_country_shield = yes

    vn_adu_restore_the_caliphate = {
        position = 5
        icon = mission_fatimid_caliphate
        required_missions = { vn_taifa_restore_andalusia }
        provinces_to_highlight = {
            is_capital = yes
            owner = {
                has_reform = feudal_theocracy
            }
        }
        trigger = {
            OR = {
                NOT = {
                    any_country = {
                        has_reform = feudal_theocracy
                    }
                }
                any_country = {
                    has_reform = feudal_theocracy
                    has_been_insulted_by_root = yes
                }
            }
        }
        effect = {
            country_event = { id = vn_missions.1 }
        }
    }
}

# vn_taifa_placate_the_christians = {
#     position = 2
#     icon = mission_tear_down_spanish_strongholds
#     required_missions = { vn_taifa_gather_support }
#     trigger = {
#         religion_group = muslim
#         NOT = { has_country_modifier = parias_modifier }
#         if = {
#             limit = {
#                 any_country = {
#                     religion_group = christian
#                     culture_group = iberian
#                 }
#             }
#             any_country = {
#                 religion_group = christian
#                 culture_group = iberian
#                 war_with = ROOT
#                 NOT = {
#                     war_score_against = {
#                         who = ROOT
#                         value = -50
#                     }
#                 }
#             }
#         }
#     }
#     effect = {
#         add_estate_loyalty = {
#             estate = estate_nobles
#             loyalty = 10
#         }
#         add_country_modifier = {
#             name = taifa_placate_the_christians_mission
#             duration = 9125
#         }
#     }
# }