#Voltaire's Nightmare Development Events
namespace = dev_events

#Generic - Growth
province_event = {
	id = dev_events.1
	title = dev_events.1.t
	desc = dev_events.1.d
	picture = CITY_DEVELOPMENT_eventPicture

	trigger = {
		NOT = { devastation = 1 }
		NOT = { development = 50 }
		NOT = {
			OR = {
				has_terrain = desert
				has_terrain = glacier
				has_terrain = jungle
			}
		}
		owner = { is_at_war = no }
		NOT = { 
			owner = { 
				OR = {
					government = tribal 
					government = native
				}
			} 
		}
		controlled_by = owner
		is_core = owner
		NOT = { has_province_flag = vn_province_rose }
		owner = {
			any_owned_province = {
				NOT = {
					OR = {
						has_province_modifier = dev_concentrated
						has_province_modifier = dev_dispersed
					}
				}
			}
		}
	}

	immediate = {
		hidden_effect = {
			owner = { highest_monarch_skill_effect = yes }
		}
	}

	is_mtth_scaled_to_size = 1

	mean_time_to_happen = {
		months = 1200
		modifier = {
			factor = 3.0
			development = 40
			NOT = { development = 50 }
		}
		modifier = {
			factor = 2.5
			development = 30
			NOT = { development = 40 }
		}
		modifier = {
			factor = 2.0
			development = 20
			NOT = { development = 30 }
		}
		modifier = {
			factor = 1.5
			development = 10
			NOT = { development = 20 }
		}
		modifier = {
			factor = 0.75
			has_dlc = "Mandate of Heaven"
			prosperity = 100
		}
		modifier = {
			factor = 0.9
			province_has_center_of_trade_of_level = 1
			NOT = { province_has_center_of_trade_of_level = 2 }
		}
		modifier = {
			factor = 0.8
			province_has_center_of_trade_of_level = 2
			NOT = { province_has_center_of_trade_of_level = 3 }
		}
		modifier = {
			factor = 0.7
			province_has_center_of_trade_of_level = 3
		}
		modifier = {
			factor = 0.9
			has_terrain = farmlands
		}
		modifier = {
			factor = 0.9
			is_capital = yes
		}
		modifier = {
			factor = 2.5
			OR = {
				has_terrain = coastal_desert
				has_terrain = hills
				has_terrain = woods
				is_island = yes
			}
			
		}
		modifier = {
			factor = 5.0
			OR = {
				has_terrain = marsh
				has_terrain = highlands
				has_terrain = drylands
				has_terrain = savannah
			}
		}
		modifier = {
			factor = 10.0
			OR = {
				has_terrain = mountain
				has_terrain = forest
			}
		}
	}

	option = {
		name = dev_events.1.a
		ai_chance = { factor = 25 }
		if = {
			limit = {
				owner = { has_ruler_flag = adm_highest }
			}
			custom_tooltip = dev_events.1.a.tt1
			add_base_tax = 2
			random_list = {
				50 = {
					add_base_production = 1
				}
				50 = {
					add_base_manpower = 1
				}
			}
		}
		else_if = {
			limit = {
				owner = { has_ruler_flag = dip_highest }
			}
			custom_tooltip = dev_events.1.a.tt2
			add_base_production = 2
			random_list = {
				50 = {
					add_base_tax = 1
				}
				50 = {
					add_base_manpower = 1
				}
			}
		}
		else_if = {
			limit = {
				owner = { has_ruler_flag = mil_highest }
			}
			custom_tooltip = dev_events.1.a.tt3
			add_base_manpower = 2
			random_list = {
				50 = {
					add_base_tax = 1
				}
				50 = {
					add_base_production = 1
				}
			}
		}
		if = {
			limit = { has_dlc = "Mandate of Heaven" }
			add_prosperity = 25
		}
		add_province_modifier = {
			name = "dev_concentrated"
			duration = 7300
		}
		custom_tooltip = vn_province_rose.tt
		set_province_flag = vn_province_rose
	}
	option = {
		name = dev_events.1.b
		ai_chance = { 
			factor = 75
			modifier = {
				factor = 0
				NOT = { owner = { num_of_cities = 3 } }
			}
		}
		add_scaled_local_adm_power = -10.0
		add_scaled_local_dip_power = -10.0
		add_scaled_local_mil_power = -10.0
		random_list = {
			33 = {
				add_base_tax = 1
			}
			33 = {
				add_base_production = 1
			}
			33 = {
				add_base_manpower = 1
			}
		}
		add_province_modifier = {
			name = "dev_dispersed"
			duration = 7300
		}
		if = {
			limit = { has_dlc = "Mandate of Heaven" }
			add_prosperity = 10
		}
		custom_tooltip = vn_province_rose.tt
		set_province_flag = vn_province_rose
		random_neighbor_province = {
			limit = { 
				owned_by = ROOT
				NOT = { 
					OR = {
						has_province_modifier = dev_dispersed 
						has_province_modifier = dev_concentrated
					}
				}
			}
			random_list = {
				33 = {
					add_base_tax = 1
				}
				33 = {
					add_base_production = 1
				}
				33 = {
					add_base_manpower = 1
				}
			}
			add_province_modifier = {
				name = "dev_dispersed"
				duration = 7300
			}
		}
		random_neighbor_province = {
			limit = { 
				owned_by = ROOT
				NOT = { 
					OR = {
						has_province_modifier = dev_dispersed 
						has_province_modifier = dev_concentrated
					}
				}
			}
			random_list = {
				33 = {
					add_base_tax = 1
				}
				33 = {
					add_base_production = 1
				}
				33 = {
					add_base_manpower = 1
				}
			}
			add_province_modifier = {
				name = "dev_dispersed"
				duration = 7300
			}
		}
	}
}

#Generic - Decline
province_event = {
	id = dev_events.2
	title = dev_events.2.t
	desc = dev_events.2.d
	picture = FAMINE_eventPicture

	trigger = {
		calc_true_if = {
			base_tax = 2
			base_production = 2
			base_manpower = 2
			amount = 2
		}
		OR = {
			base_tax = 3
			base_production = 3
			base_manpower = 3
		}
		if = {
			limit = { has_dlc = "Mandate of Heaven" }
			NOT = { prosperity = 100 }
		}
		owner = {
			any_owned_province = {
				NOT = {
					OR = {
						has_province_modifier = dev_crisis
						has_province_modifier = dev_lifesupport
					}
				}
			}
		}
		NOT = { has_province_flag = vn_province_fell }
	}
	mean_time_to_happen = {
		months = 1200
		modifier = {
			factor = 0.7
			development = 50
		}
		modifier = {
			factor = 0.75
			development = 40
			NOT = { development = 50 }
		}
		modifier = {
			factor = 0.8
			development = 30
			NOT = { development = 40 }
		}
		modifier = {
			factor = 0.85
			development = 20
			NOT = { development = 30 }
		}
		modifier = {
			factor = 0.9
			development = 10
			NOT = { development = 20 }
		}
		modifier = {
			factor = 0.9
			devastation = 1
			NOT = { devastation = 25 }
		}
		modifier = {
			factor = 0.85
			devastation = 25
			NOT = { devastation = 50 }
		}
		modifier = {
			factor = 0.8
			devastation = 50
			NOT = { devastation = 75 }
		}
		modifier = {
			factor = 0.75
			devastation = 75
		}
		modifier = {
			factor = 0.9
			NOT = { controlled_by = ROOT }
		}
		modifier = {
			factor = 0.9
			owner = { is_at_war = yes }
		}
	}

	
	immediate = {
		hidden_effect = {
			owner = { highest_monarch_skill_effect = yes }
			if = {
				limit = {
					NOT = { base_tax = 2 }
				}
				set_province_flag = basetax_low
				add_base_production = -1
				add_base_manpower = -1
				random_list = {
					50 = {
						add_base_production = -1
					}
					50 = {
						add_base_manpower = -1
					}
				}
			}
			else_if = {
				limit = {
					NOT = { base_production = 2 }
				}
				set_province_flag = baseprod_low
				add_base_tax = -1
				add_base_manpower = -1
				random_list = {
					50 = {
						add_base_tax = -1
					}
					50 = {
						add_base_manpower = -1
					}
				}
			}
			else_if = {
				limit = {
					NOT = { base_manpower = 2 }
				}
				set_province_flag = baseman_low
				add_base_tax = -1
				add_base_production = -1
				random_list = {
					50 = {
						add_base_tax = -1
					}
					50 = {
						add_base_production = -1
					}
				}
			}
			else = {
				add_base_tax = -1
				add_base_production = -1
				add_base_manpower = -1
			}
		}
	}


	option = {	
		name = dev_events.2.a
		ai_chance = { factor = 50 }
		if = {
			limit = { has_dlc = "Mandate of Heaven" }
			add_prosperity = -25
		}
		custom_tooltip = dev_events.2.b.tt4
		tooltip = {
			if = {
				limit = {
					has_province_flag = basetax_low
				}
				add_base_production = -1
				add_base_manpower = -1
				random_list = {
					50 = {
						add_base_production = -1
					}
					50 = {
						add_base_manpower = -1
					}
				}
			}
			else_if = {
				limit = {
					has_province_flag = baseprod_low
				}
				add_base_tax = -1
				add_base_manpower = -1
				random_list = {
					50 = {
						add_base_tax = -1
					}
					50 = {
						add_base_manpower = -1
					}
				}
			}
			else_if = {
				limit = {
					has_province_flag = baseman_low
				}
				add_base_tax = -1
				add_base_production = -1
				random_list = {
					50 = {
						add_base_tax = -1
					}
					50 = {
						add_base_production = -1
					}
				}
			}
			else = {
				add_base_tax = -1
				add_base_production = -1
				add_base_manpower = -1
			}
		}
		custom_tooltip = dev_events.2.a.tt1
		add_province_modifier = {
			name = "dev_crisis"
			duration = 7300
		}
		custom_tooltip = vn_province_fell.tt
		set_province_flag = vn_province_fell
	}
	option = {
		name = dev_events.2.b
		ai_chance = { 
			factor = 50
			modifier = {
				factor = 0
				NOT = { owner = { years_of_income = 0.5 } }
			}
			modifier = {
				factor = 0
				owner = { num_of_loans = 1 }
			}
		}
		custom_tooltip = dev_events.2.b.tt4
		tooltip = {
			if = {
				limit = {
					has_province_flag = basetax_low
				}
				add_base_production = -1
				add_base_manpower = -1
				random_list = {
					50 = {
						add_base_production = -1
					}
					50 = {
						add_base_manpower = -1
					}
				}
			}
			else_if = {
				limit = {
					has_province_flag = baseprod_low
				}
				add_base_tax = -1
				add_base_manpower = -1
				random_list = {
					50 = {
						add_base_tax = -1
					}
					50 = {
						add_base_manpower = -1
					}
				}
			}
			else_if = {
				limit = {
					has_province_flag = baseman_low
				}
				add_base_tax = -1
				add_base_production = -1
				random_list = {
					50 = {
						add_base_tax = -1
					}
					50 = {
						add_base_production = -1
					}
				}
			}
			else = {
				add_base_tax = -1
				add_base_production = -1
				add_base_manpower = -1
			}
		}
		custom_tooltip = dev_events.2.a.tt1
		if = {
			limit = {
				owner = { has_ruler_flag = adm_highest }
			}
			custom_tooltip = dev_events.2.b.tt1
			add_base_tax = 1
		}
		else_if = {
			limit = {
				owner = { has_ruler_flag = dip_highest }
			}
			custom_tooltip = dev_events.2.b.tt2
			add_base_production = 1
		}
		else_if = {
			limit = {
				owner = { has_ruler_flag = mil_highest }
			}
			custom_tooltip = dev_events.2.b.tt3
			add_base_manpower = 1
		}
		owner = { add_years_of_income = -0.5 }
		add_devastation = -10
		add_province_modifier = {
			name = "dev_lifesupport"
			duration = 7300
		}
		custom_tooltip = vn_province_fell.tt
		set_province_flag = vn_province_fell
		if = {
			limit = { has_dlc = "Mandate of Heaven" }
			add_prosperity = -10
		}
	}
	after = {
		clr_province_flag = basetax_low
		clr_province_flag = baseprod_low
		clr_province_flag = baseman_low
	}
}

#Historical Rise / Fall of Cities

#Rise of X
province_event = {
	id = dev_events.3
	title = dev_events.3.t
	desc = {
		#Paris
		trigger = { province_id = 548 }
		desc = dev_events.3.d1
	}
	desc = {
		#Salamanca
		trigger = { province_id = 2718 }
		desc = dev_events.3.d2
	}
	desc = {
		#Amsterdam
		trigger = { province_id = 328 }
		desc = dev_events.3.d3
	}
	desc = {
		#Madrid
		trigger = { province_id = 1236 }
		desc = dev_events.3.d4
	}
	desc = {
		#Marrakesh
		trigger = { province_id = 4762 }
		desc = dev_events.3.d5
	}
	picture = GREAT_BUILDING_eventPicture

	major = yes

	trigger = {
		controlled_by = owner
		is_core = owner
		NOT = { has_province_flag = vn_rise_major }
		NOT = { devastation = 1 }
		OR = {
			#Paris
			AND = {
				province_id = 548
				has_institution = universities
			}
			#Salamanca
			AND = {
				province_id = 2718
				has_institution = universities
			}
			#Amsterdam
			AND = {
				province_id = 328
				has_institution = global_trade
			}
			#Madrid
			AND = {
				province_id = 1236
				has_institution = printing_press
			}
			#Marrakesh
			AND = {
				province_id = 4762
				has_institution = feudalism
			}
		}
	}

	mean_time_to_happen = {
		months = 150
		modifier = {
			factor = 2.0
			development = 40
			NOT = { development = 50 }
		}
		modifier = {
			factor = 1.75
			development = 30
			NOT = { development = 40 }
		}
		modifier = {
			factor = 1.5
			development = 20
			NOT = { development = 30 }
		}
		modifier = {
			factor = 1.25
			development = 10
			NOT = { development = 20 }
		}
		modifier = {
			factor = 0.75
			has_dlc = "Mandate of Heaven"
			prosperity = 100
		}
		modifier = {
			factor = 0.9
			is_capital = yes
		}
	}

	immediate = {
		hidden_effect = {
			owner = { save_event_target_as = rise_owner_country }
		}
	}

	option = {
		name = dev_events.3.a
		ai_chance = { factor = 100 }
		if = {
			limit = {
				OR = {
					province_id = 548
					province_id = 2718
					province_id = 328
					province_id = 1236
					province_id = 4762
				}
			}
			add_base_tax = 2
			add_base_production = 2
			add_base_manpower = 2
		}
		owner = { 
			add_prestige = 25
			add_years_of_income = 0.5
		}
		if = {
			limit = { has_dlc = "Mandate of Heaven" }
			add_prosperity = 25
		}
		if = {	
			limit = { 
				has_dlc = "Dharma" 
				province_has_center_of_trade_of_level = 1
				NOT = { province_has_center_of_trade_of_level = 3 }
			}
			add_center_of_trade_level = 1
		}
		set_province_flag = vn_rise_major
		set_province_flag = vn_province_rose
	}
}

#Fall of X
province_event = {
	id = dev_events.4
	title = dev_events.4.t
	desc = {
		#Constantinople
		trigger = { province_id = 2233 }
		desc = dev_events.4.d1
		#Amalfi
		trigger = { province_id = 2880 }
		desc = dev_events.4.d2
	}
	picture = PLAGUE_eventPicture

	major = yes

	trigger = {
		NOT = { prosperity = 100 }
		NOT = { has_province_flag = vn_fall_major }
		OR = {
			#Constantinople
			AND = {
				province_id = 2233
				has_global_flag = constantinople_delivered
			}
			#Amalfi
			AND = {
				province_id = 2880
				is_year = 1150
				NOT = { is_year = 1350 }
			}
		}
	}

	mean_time_to_happen = {
		months = 150
		modifier = {
			factor = 0.7
			development = 50
		}
		modifier = {
			factor = 0.75
			development = 40
			NOT = { development = 50 }
		}
		modifier = {
			factor = 0.8
			development = 30
			NOT = { development = 40 }
		}
		modifier = {
			factor = 0.85
			development = 20
			NOT = { development = 30 }
		}
		modifier = {
			factor = 0.9
			development = 10
			NOT = { development = 20 }
		}
		modifier = {
			factor = 0.9
			devastation = 1
			NOT = { devastation = 25 }
		}
		modifier = {
			factor = 0.85
			devastation = 25
			NOT = { devastation = 50 }
		}
		modifier = {
			factor = 0.8
			devastation = 50
			NOT = { devastation = 75 }
		}
		modifier = {
			factor = 0.75
			devastation = 75
		}
		modifier = {
			factor = 0.9
			NOT = { controlled_by = ROOT }
		}
		modifier = {
			factor = 0.9
			owner = { is_at_war = yes }
		}
	}

	immediate = {
		hidden_effect = {
			owner = { save_event_target_as = fall_owner_country }
		}
	}

	option = {
		name = dev_events.4.a
		ai_chance = { factor = 100 }
		if = {
			limit = {
				OR = {
					province_id = 2233
					province_id = 1350
				}
			}
			add_base_tax = -2
			add_base_production = -2
			add_base_manpower = -2
		}
		add_devastation = 25
		owner = { 
			add_prestige = -20
		}
		if = {
			limit = { has_dlc = "Mandate of Heaven" }
			add_prosperity = -25
		}
		set_province_flag = vn_fall_major
		set_province_flag = vn_province_fell
	}
}

#Destruction of X (Siege)
province_event = {
	id = dev_events.5
	title = dev_events.5.t
	desc = {
		#x
		trigger = { }
		desc = dev_events.5.d1
	}
	picture = SIEGE_eventPicture

	is_triggered_only = yes
	major = yes

	trigger = {
		owned_by = ROOT
		NOT = { has_province_flag = vn_fall_major }
		OR = {
			#x
		}
	}

	immediate = {
		hidden_effect = {
			owner = { save_event_target_as = destruction_owner_country }
		}
	}

	option = {
		name = dev_events.5.a
		ai_chance = { factor = 100 }
		if = {
			limit = {
				OR = {
					#x
				}
			}
			add_base_tax = -2
			add_base_production = -2
			add_base_manpower = -2
		}
		add_devastation = 100
		owner = { 
			add_prestige = -50
		}
		if = {
			limit = { has_dlc = "Mandate of Heaven" }
			add_prosperity = -100
		}
		set_province_flag = vn_fall_major
		set_province_flag = vn_province_fell
	}
}