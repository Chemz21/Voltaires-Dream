#Fragmentation of Poland disaster events
#By Isildur

namespace = fragmentation_of_poland

country_event = {
	id = fragmentation_of_poland.1
	title = fragmentation_of_poland.1.t
	desc = fragmentation_of_poland.1.d
	picture = KING_SICK_IN_BED_eventPicture

	is_triggered_only = yes
	major = yes

	option = {	#Accept will
		name = fragmentation_of_poland.1.a
        ai_chance = { factor = 100 }
		#Krakow (Seniorate) to ingame heir
		kill_ruler = yes
		custom_tooltip = fragmentation_of_poland.1.tt
		hidden_effect = {
			if = {
				limit = {
					KRA = { is_subject_of = ROOT }
				}
				free_vassal = KRA
				break_union = KRA
			}
			change_tag = KRA
		}
		custom_tooltip = fragmentation_of_poland.1.tt4
		hidden_effect = {
			#Wielkopolska
			# czarnkow_area = {
			# 	limit = { 
			# 		country_or_non_sovereign_subject_holds = ROOT
			# 		NOT = { owned_by = WKP }
			# 	}
			# 	owner = { remove_core = PREV }
			# 	cede_province = WKP
			# 	add_core = WKP
			# }
			# posen_area = {
			# 	limit = { 
			# 		country_or_non_sovereign_subject_holds = ROOT
			# 		NOT = { owned_by = WKP }
			# 	}
			# 	owner = { remove_core = PREV }
			# 	cede_province = WKP
			# 	add_core = WKP
			# }
			# gniezno_area = {
			# 	limit = { 
			# 		country_or_non_sovereign_subject_holds = ROOT
			# 		NOT = { owned_by = WKP }
			# 	}
			# 	owner = { remove_core = PREV }
			# 	cede_province = WKP
			# 	add_core = WKP
			# }
			if = {
				limit = {
					WKP = { is_subject_of = ROOT }
				}
				free_vassal = WKP
				break_union = WKP
			}
			else = {
				release = WKP
				WKP = {
					change_government = monarchy
					add_reform = feudal_monarchy
				}
			}
			create_alliance = WKP
			WKP = {
				define_ruler = {
					dynasty = ROOT
					max_age = 20
					adm = 0
					dip = 0
					mil = 0
				}
			}
		}
		custom_tooltip = fragmentation_of_poland.1.tt2
		hidden_effect = {
			#Mazovia
			# mazovia_region = {
			# 	limit = { 
			# 		country_or_non_sovereign_subject_holds = ROOT
			# 		NOT = { owned_by = MAZ }
			# 	}
			# 	owner = { remove_core = PREV }
			# 	cede_province = MAZ
			# 	add_core = MAZ
			# }
			# leczyca_area = {
			# 	limit = { 
			# 		country_or_non_sovereign_subject_holds = ROOT 
			# 		NOT = { owned_by = MAZ }
			# 	}
			# 	owner = { remove_core = PREV }
			# 	cede_province = MAZ
			# 	add_core = MAZ
			# }
			# kulmerland_area = {
			# 	limit = { 
			# 		country_or_non_sovereign_subject_holds = ROOT 
			# 		NOT = { owned_by = MAZ }
			# 	}
			# 	owner = { remove_core = PREV }
			# 	cede_province = MAZ
			# 	add_core = MAZ
			# }
			if = {
				limit = {
					MAZ = { is_subject_of = ROOT }
				}
				free_vassal = MAZ
				break_union = MAZ
			}
			else = {
				release = MAZ
				MAZ = {
					change_government = monarchy
					add_reform = feudal_monarchy
				}
			}
			create_alliance = MAZ
			MAZ = {
				define_ruler = {
					dynasty = ROOT
					max_age = 20
					adm = 0
					dip = 0
					mil = 0
				}
			}
		}
		custom_tooltip = fragmentation_of_poland.1.tt3
		hidden_effect = {
			#Silesia
			# silesia_region = {
			# 	limit = { 
			# 		country_or_non_sovereign_subject_holds = ROOT
			# 		NOT = { owned_by = SIL }
			# 	}
			# 	owner = {
			# 		remove_core = PREV
			# 	}
			# 	cede_province = SIL
			# 	add_core = SIL
			# }
			every_owned_province = {
				limit = { is_core = SIL }
				owner = { remove_core = PREV }
				cede_province = SIL
			}
			if = {
				limit = {
					SIL = { is_subject_of = ROOT }
				}
				free_vassal = SIL
				break_union = SIL
			}
			else = {
				release = SIL
				SIL = {
					change_government = monarchy
					add_reform = feudal_monarchy
				}
			}
			create_alliance = SIL
			SIL = {
				define_ruler = {
					dynasty = ROOT
					max_age = 20
					adm = 0
					dip = 0
					mil = 0
				}
			}
		}
		custom_tooltip = fragmentation_of_poland.1.tt7
		hidden_effect = {
			#Malopolska
			# sandomierz_area = {
			# 	limit = { 
			# 		country_or_non_sovereign_subject_holds = ROOT
			# 		NOT = { owned_by = SDZ }
			# 	}
			# 	owner = { remove_core = PREV }
			# 	cede_province = SDZ
			# 	add_core = SDZ
			# }
			# lublin_area = {
			# 	limit = { 
			# 		country_or_non_sovereign_subject_holds = ROOT
			# 		NOT = { owned_by = SDZ }
			# 	}
			# 	owner = { remove_core = PREV }
			# 	cede_province = SDZ
			# 	add_core = SDZ
			# }
			# radom_area = {
			# 	limit = { 
			# 		country_or_non_sovereign_subject_holds = ROOT
			# 		NOT = { owned_by = SDZ }
			# 	}
			# 	owner = { remove_core = PREV }
			# 	cede_province = SDZ
			# 	add_core = SDZ
			# }
			if = {
				limit = {
					SDZ = { is_subject_of = ROOT }
				}
				free_vassal = SDZ
				break_union = SDZ
			}
			else = {
				release = SDZ
				SDZ = {
					change_government = monarchy
					add_reform = feudal_monarchy
				}
			}
			create_alliance = SDZ
			SDZ = {
				define_ruler = {
					dynasty = ROOT
					max_age = 20
					adm = 0
					dip = 0
					mil = 0
				}
			}
		}
		custom_tooltip = fragmentation_of_poland.1.tt5
		custom_tooltip = fragmentation_of_poland.1.tt6
		hidden_effect = {
			#Pomerania/Pomerelia
			hinterpommern_region = {
				limit = { 
					country_or_non_sovereign_subject_holds = ROOT
					NOT = { owned_by = POM }
				}
				owner = { remove_core = PREV }
				cede_province = POM
				add_core = POM
			}
			westpreussennorth_area = {
				limit = { 
					country_or_non_sovereign_subject_holds = ROOT
					NOT = { owned_by = PML }
				}
				owner = { remove_core = PREV }
				cede_province = PML
				add_core = PML
			}
			westpreussensouth_area = {
				limit = { 
					country_or_non_sovereign_subject_holds = ROOT
					NOT = { owned_by = PML }
				}
				owner = { remove_core = PREV }
				cede_province = PML
				add_core = PML
			}
		}
		# hidden_effect = {
		# 	#cleanup
		# 	sieradz_area = {
		# 		limit = {
		# 			country_or_non_sovereign_subject_holds = ROOT
		# 			NOT = { owned_by = ROOT }
		# 		}
		# 		owner = { remove_core = PREV }
		# 		cede_province = ROOT
		# 		add_core = ROOT
		# 	}
		# 	2196 = {
		# 		if = {
		# 			limit = { owned_by = SDZ }
		# 			owner = { remove_core = PREV }
		# 			cede_province = ROOT
		# 			add_core = ROOT
		# 		}
		# 	}
		# 	5994 = {
		# 		if = {
		# 			limit = { owned_by = SDZ }
		# 			owner = { remove_core = PREV }
		# 			cede_province = ROOT
		# 			add_core = ROOT
		# 		}
		# 	}
		# 	2301 = {
		# 		if = {
		# 			limit = { owned_by = SDZ }
		# 			owner = { remove_core = PREV }
		# 			cede_province = ROOT
		# 			add_core = ROOT
		# 		}
		# 	}
		# 	5253 = {
		# 		if = {
		# 			limit = { owned_by = WKP }
		# 			owner = { remove_core = PREV }
		# 			cede_province = ROOT
		# 			add_core = ROOT
		# 		}
		# 	}
		# 	2769 = {
		# 		if = {
		# 			limit = { owned_by = WKP }
		# 			owner = { remove_core = PREV }
		# 			cede_province = ROOT
		# 			add_core = ROOT
		# 		}
		# 	}
		# 	2795 = {
		# 		if = {
		# 			limit = { owned_by = WKP }
		# 			owner = { remove_core = PREV }
		# 			cede_province = ROOT
		# 			add_core = ROOT
		# 		}
		# 	}
		# 	2757 = {
		# 		if = {
		# 			limit = { owned_by = WKP }
		# 			owner = { remove_core = PREV }
		# 			cede_province = ROOT
		# 			add_core = ROOT
		# 		}
		# 	}
		# 	#leczyca
		# 	5993 = {
		# 		if = {
		# 			limit = { owned_by = MAZ }
		# 			owner = { remove_core = PREV }
		# 			cede_province = ROOT
		# 			add_core = ROOT
		# 		}
		# 	}
		# 	2266 = {
		# 		if = {
		# 			limit = { owned_by = MAZ }
		# 			owner = { remove_core = PREV }
		# 			cede_province = ROOT
		# 			add_core = ROOT
		# 		}
		# 	}
		# 	5992 = {
		# 		if = {
		# 			limit = { owned_by = MAZ }
		# 			owner = { remove_core = PREV }
		# 			cede_province = ROOT
		# 			add_core = ROOT
		# 		}
		# 	}
		# 	5991 = {
		# 		if = {
		# 			limit = { owned_by = MAZ }
		# 			owner = { remove_core = PREV }
		# 			cede_province = ROOT
		# 			add_core = ROOT
		# 		}
		# 	}
		# 	#wkp sieradz
		# 	2761 = {
		# 		if = {
		# 			limit = { owned_by = ROOT }
		# 			remove_core = ROOT
		# 			cede_province = WKP
		# 			add_core = WKP
		# 		}
		# 	}
		# 	5247 = {
		# 		if = {
		# 			limit = { owned_by = ROOT }
		# 			remove_core = ROOT
		# 			cede_province = WKP
		# 			add_core = WKP
		# 		}
		# 	}
		# }
	}
	option = {	#Decline will
		name = fragmentation_of_poland.1.b
        ai_chance = { factor = 100 }
		kill_ruler = yes
		hidden_effect = {
			random_owned_province = {
				limit = { is_core = SIL }
				save_event_target_as = piast_silesia_province
			}
			random_owned_province = {
				limit = { is_core = WKP }
				save_event_target_as = piast_wielkopolska_province
			}
			random_owned_province = {
				limit = { is_core = MAZ }
				save_event_target_as = piast_mazovia_province
			}
			random_owned_province = {
				limit = { is_core = SDZ }
				save_event_target_as = piast_malopolska_province
			}
			set_saved_name = {
				key = piast_silesia_leader
				type = advisor
				scope = SIL
			}
			set_saved_name = {
				key = piast_wielkopolska_leader
				type = advisor
				scope = WKP
			}
			set_saved_name = {
				key = piast_mazovia_leader
				type = advisor
				scope = MAZ
			}
			set_saved_name = {
				key = piast_malopolska_leader
				type = advisor
				scope = SDZ
			}
		}
		add_war_exhaustion = 5
		add_stability = -2
		if = {
			limit = {
				MAZ = {
					exists = yes
					is_subject_of = ROOT
				}
			}
			MAZ = {
				declare_war_with_cb = {
					casus_belli = cb_independence_war
					who = ROOT
				}
			}
		}
		else = {
			event_target:piast_mazovia_province = {
				spawn_rebels = {
					type = nationalist_rebels
					size = 3
					name = piast_mazovia_leader
				}
				change_controller = REB
			}
		}
		if = {
			limit = {
				SIL = {
					exists = yes
					is_subject_of = ROOT
				}
			}
			SIL = {
				declare_war_with_cb = {
					casus_belli = cb_independence_war
					who = ROOT
				}
			}
		}
		else = {
			event_target:piast_silesia_province = {
				spawn_rebels = {
					type = nationalist_rebels
					size = 3
					name = piast_silesia_leader
				}
				change_controller = REB
			}
		}
		if = {
			limit = {
				SDZ = {
					exists = yes
					is_subject_of = ROOT
				}
			}
			SDZ = {
				declare_war_with_cb = {
					casus_belli = cb_independence_war
					who = ROOT
				}
			}
		}
		else = {
			event_target:piast_malopolska_province = {
				spawn_rebels = {
					type = nationalist_rebels
					size = 3
					name = piast_malopolska_leader
				}
				change_controller = REB
			}
		}
		if = {
			limit = {
				WKP = {
					exists = yes
					is_subject_of = ROOT
				}
			}
			WKP = {
				declare_war_with_cb = {
					casus_belli = cb_independence_war
					who = ROOT
				}
			}
		}
		else = {
			event_target:piast_wielkopolska_province = {
				spawn_rebels = {
					type = nationalist_rebels
					size = 3
					name = piast_wielkopolska_leader
				}
				change_controller = REB
			}
		}
	}
}