#Fragmentation of Poland disaster events
#By Isildur

namespace = fragmentation_of_poland

country_event = {
	id = fragmentation_of_poland.1
	title = fragmentation_of_poland.1.t
	desc = fragmentation_of_poland.1.d
	picture = KING_SICK_IN_BED_eventPicture

	is_triggered_only = yes
	major = yes

	mean_time_to_happen = {
		days = 1
	}

	immediate = {
		set_global_flag = had_fragmentation_of_poland
		set_country_flag = poland_fragmentation_active
	}

	option = {	#Accept will
		name = fragmentation_of_poland.1.a
        ai_chance = { 
			factor = 75
			modifier = {
				factor = 1.5
				OR = {
					heir_has_personality = just_personality
					heir_has_personality = careful_personality
					heir_has_personality = well_advised_personality
				}
			}
			modifier = {
				factor = 0.5
				OR = {
					heir_has_personality = cruel_personality
					heir_has_personality = fierce_negotiator_personality
					heir_has_personality = malevolent_personality
				}
			}
		}
		#Krakow (Seniorate) to ingame heir
		custom_tooltip = fragmentation_of_poland.1.tt
		hidden_effect = {
			if = {
				limit = {
					KRA = { is_subject_of = ROOT }
				}
				free_vassal = KRA
				break_union = KRA
			}
			change_tag = KRA
		}
		custom_tooltip = fragmentation_of_poland.1.tt4
		hidden_effect = {
			#Wielkopolska
			if = {
				limit = {
					WKP = { is_subject_of = ROOT }
				}
				free_vassal = WKP
				break_union = WKP
			}
			else = {
				release = WKP
				WKP = {
					change_government = monarchy
					add_reform = feudal_monarchy
				}
			}
			create_alliance = WKP
			WKP = {
				define_ruler = {
					dynasty = ROOT
					max_age = 20
					adm = 0
					dip = 0
					mil = 0
				}
			}
		}
		custom_tooltip = fragmentation_of_poland.1.tt2
		hidden_effect = {
			#Mazovia
			if = {
				limit = {
					MAZ = { is_subject_of = ROOT }
				}
				free_vassal = MAZ
				break_union = MAZ
			}
			else = {
				release = MAZ
				MAZ = {
					change_government = monarchy
					add_reform = feudal_monarchy
				}
			}
			create_alliance = MAZ
			MAZ = {
				define_ruler = {
					dynasty = ROOT
					max_age = 20
					adm = 0
					dip = 0
					mil = 0
				}
			}
		}
		custom_tooltip = fragmentation_of_poland.1.tt3
		hidden_effect = {
			#Silesia
			every_owned_province = {
				limit = { is_core = SIL }
				owner = { remove_core = PREV }
				cede_province = SIL
			}
			if = {
				limit = {
					SIL = { is_subject_of = ROOT }
				}
				free_vassal = SIL
				break_union = SIL
			}
			else = {
				release = SIL
				SIL = {
					change_government = monarchy
					add_reform = feudal_monarchy
				}
			}
			create_alliance = SIL
			SIL = {
				define_ruler = {
					dynasty = ROOT
					max_age = 20
					adm = 0
					dip = 0
					mil = 0
				}
			}
		}
		custom_tooltip = fragmentation_of_poland.1.tt7
		hidden_effect = {
			#Malopolska
			if = {
				limit = {
					SDZ = { is_subject_of = ROOT }
				}
				free_vassal = SDZ
				break_union = SDZ
			}
			else = {
				release = SDZ
				SDZ = {
					change_government = monarchy
					add_reform = feudal_monarchy
				}
			}
			create_alliance = SDZ
			SDZ = {
				define_ruler = {
					dynasty = ROOT
					max_age = 20
					adm = 0
					dip = 0
					mil = 0
				}
			}
		}
		custom_tooltip = fragmentation_of_poland.1.tt5
		custom_tooltip = fragmentation_of_poland.1.tt6
		hidden_effect = {
			#Pomerania/Pomerelia
			hinterpommern_region = {
				limit = { 
					country_or_non_sovereign_subject_holds = ROOT
					NOT = { owned_by = POM }
				}
				owner = { remove_core = PREV }
				cede_province = POM
				add_core = POM
			}
			westpreussennorth_area = {
				limit = { 
					country_or_non_sovereign_subject_holds = ROOT
					NOT = { owned_by = PML }
				}
				owner = { remove_core = PREV }
				cede_province = PML
				add_core = PML
			}
			westpreussensouth_area = {
				limit = { 
					country_or_non_sovereign_subject_holds = ROOT
					NOT = { owned_by = PML }
				}
				owner = { remove_core = PREV }
				cede_province = PML
				add_core = PML
			}
		}
		kill_ruler = yes
	}
	option = {	#Decline will
		name = fragmentation_of_poland.1.b
        ai_chance = { 
			factor = 25
			modifier = {
				factor = 1.5
				OR = {
					heir_has_personality = cruel_personality
					heir_has_personality = fierce_negotiator_personality
					heir_has_personality = malevolent_personality
				}
			}
			modifier = {
				factor = 0.5
				OR = {
					heir_has_personality = just_personality
					heir_has_personality = careful_personality
					heir_has_personality = well_advised_personality
				}
			}
		}
		hidden_effect = {
			random_owned_province = {
				limit = { is_core = SIL }
				save_event_target_as = piast_silesia_province
			}
			random_owned_province = {
				limit = { is_core = WKP }
				save_event_target_as = piast_wielkopolska_province
			}
			random_owned_province = {
				limit = { is_core = MAZ }
				save_event_target_as = piast_mazovia_province
			}
			random_owned_province = {
				limit = { is_core = SDZ }
				save_event_target_as = piast_malopolska_province
			}
			set_saved_name = {
				key = piast_silesia_leader
				type = advisor
				scope = SIL
			}
			set_saved_name = {
				key = piast_wielkopolska_leader
				type = advisor
				scope = WKP
			}
			set_saved_name = {
				key = piast_mazovia_leader
				type = advisor
				scope = MAZ
			}
			set_saved_name = {
				key = piast_malopolska_leader
				type = advisor
				scope = SDZ
			}
		}
		add_war_exhaustion = 5
		add_stability = -2
		if = {
			limit = {
				MAZ = {
					exists = yes
					is_subject_of = ROOT
				}
			}
			MAZ = {
				declare_war_with_cb = {
					casus_belli = cb_independence_war
					who = ROOT
				}
				define_ruler = {
					dynasty = ROOT
					max_age = 20
					adm = 0
					dip = 0
					mil = 0
				}
			}
		}
		else = {
			event_target:piast_mazovia_province = {
				spawn_rebels = {
					type = nationalist_rebels
					size = 3
					name = piast_mazovia_leader
				}
				change_controller = REB
			}
		}
		if = {
			limit = {
				SIL = {
					exists = yes
					is_subject_of = ROOT
				}
			}
			SIL = {
				declare_war_with_cb = {
					casus_belli = cb_independence_war
					who = ROOT
				}
				define_ruler = {
					dynasty = ROOT
					max_age = 20
					adm = 0
					dip = 0
					mil = 0
				}
			}
		}
		else = {
			event_target:piast_silesia_province = {
				spawn_rebels = {
					type = nationalist_rebels
					size = 3
					name = piast_silesia_leader
				}
				change_controller = REB
			}
		}
		if = {
			limit = {
				SDZ = {
					exists = yes
					is_subject_of = ROOT
				}
			}
			SDZ = {
				declare_war_with_cb = {
					casus_belli = cb_independence_war
					who = ROOT
				}
				define_ruler = {
					dynasty = ROOT
					max_age = 20
					adm = 0
					dip = 0
					mil = 0
				}
			}
		}
		else = {
			event_target:piast_malopolska_province = {
				spawn_rebels = {
					type = nationalist_rebels
					size = 3
					name = piast_malopolska_leader
				}
				change_controller = REB
			}
		}
		if = {
			limit = {
				WKP = {
					exists = yes
					is_subject_of = ROOT
				}
			}
			WKP = {
				declare_war_with_cb = {
					casus_belli = cb_independence_war
					who = ROOT
				}
				define_ruler = {
					dynasty = ROOT
					max_age = 20
					adm = 0
					dip = 0
					mil = 0
				}
			}
		}
		else = {
			event_target:piast_wielkopolska_province = {
				spawn_rebels = {
					type = nationalist_rebels
					size = 3
					name = piast_wielkopolska_leader
				}
				change_controller = REB
			}
		}
		hidden_effect = {
			clear_saved_name = piast_malopolska_leader
			clear_saved_name = piast_mazovia_leader
			clear_saved_name = piast_silesia_leader
			clear_saved_name = piast_wielkopolska_leader
		}
		kill_ruler = yes
	}
}

country_event = {
	id = fragmentation_of_poland.100
	title = fragmentation_of_poland.100.t
	desc = fragmentation_of_poland.100.d
	picture = GOOD_WITH_MONARCH_eventPicture

	is_triggered_only = yes

	mean_time_to_happen = {
		days = 1
	}

	option = {
		name = fragmentation_of_poland.100.a
        ai_chance = { factor = 100 }
		add_stability_or_adm_power = yes
		add_prestige = 25
		add_legitimacy = 20
    }
}