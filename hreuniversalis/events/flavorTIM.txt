########################################
# Flavor Events for Timurid
#
# written by Sara Wendel-Örtqvist
# Events rewritten and adapted for patch 1.22 by Henrik Lohmander
########################################

namespace = flavor_tim
normal_or_historical_nations = yes

# Muhammad Baysonqor's Rebellion
country_event = {
	id = flavor_tim.0
	title = "flavor_tim.0.t"
	desc = "flavor_tim.0.d"
	picture = OVEREXTENSION_eventPicture
	
	fire_only_once = yes
	
	trigger = {
		tag = TIM
		exists = QOM
		has_ruler = "Shah Rukh"
	}

	mean_time_to_happen = {
		months = 1
	}
	
	option = { 
		name = "flavor_tim.0.a" #
		custom_tooltip = flavor_tim.0.a.tt
		
		hidden_effect = {
			every_country = {
				limit = {
					NOT = { tag = ROOT }
					OR = {
						is_neighbor_of = ROOT
						dynasty = Barulas
						any_owned_province = {
							is_core = TIM
						}
						any_neighbor_country = {
							dynasty = Barulas
						}
					}
				}
				country_event = { id = flavor_tim.4 }
			}
		}
	}
}

# Death of Shah Rukh
country_event = {
	id = flavor_tim.1
	title = "flavor_tim.1.t"
	desc = "flavor_tim.1.d"
	picture = DEATH_OF_HEIR_eventPicture
	
	is_triggered_only = yes
	fire_only_once = yes
	
	trigger = {
		tag = TIM
		NOT = { has_global_flag = death_of_shah_rukh }
	}

	mean_time_to_happen = {
		days = 1
	}
	
	immediate = {
		set_global_flag = death_of_shah_rukh
		hidden_effect = {
			country_event = { 
				id = flavor_tim.20 
				days = 30
				random = 60
			}
		}
	}
	
	option = { 
		name = "flavor_tim.1.a" # My time has come!
		custom_tooltip = flavor_tim.1.a.tt
		hidden_effect = {
			every_country = {
				limit = {
					NOT = { tag = ROOT }
					OR = {
						is_neighbor_of = ROOT
						dynasty = Barulas
						any_owned_province = {
							is_core = TIM
						}
						any_neighbor_country = {
							dynasty = Barulas
						}
					}
				}
				country_event = { id = flavor_tim.2 }
			}
		}
	}
}

# Death of Shah Rukh
country_event = {
	id = flavor_tim.2
	title = "flavor_tim.2.t"
	desc = "flavor_tim.2.d"
	picture = DEATH_OF_HEIR_eventPicture
	
	is_triggered_only = yes

	option = {
		name = "flavor_tim.2.a" # My time has come!
		trigger = { dynasty = Barulas }
		custom_tooltip = flavor_tim.2.a.tt
	}
	option = {
		name = "flavor_tim.2.b" #
		trigger = { NOT = { dynasty = Barulas } }
		custom_tooltip = flavor_tim.2.a.tt
		# if = {
		# 	limit = {
		# 		NOT = { dynasty = "Barulas" }
		# 		government = monarchy
		# 		NOT = { tag = HLR }
		# 		NOT = { tag = ROM }
		# 		NOT = { tag = MUG }
		# 		NOT = { tag = PER }
		# 		OR = {
		# 			culture_group = iranian
		# 			primary_culture = uzbehk
		# 			primary_culture = turkmeni
		# 		}
		# 		NOT = { primary_culture = azerbaijani }
		# 		NOT = { has_reform = tribal_federation }
		# 		religion_group = muslim
		# 	}
		# custom_tooltip = flavor_tim.2.b.tt
		# }
	}
}

# Ulugh Beg's Observatory
country_event = {
	id = flavor_tim.3
	title = "flavor_tim.EVTNAME3"
	desc = "flavor_tim.EVTDESC3"
	picture = UNIVERSITY_eventPicture
	
	fire_only_once = yes
	
	trigger = {
		tag = TIM
		has_ruler = "Ulugh Beg"
		NOT = { is_year = 1465 }
	}

	mean_time_to_happen = {
		months = 63
	}
	
	option = {
		name = "flavor_tim.EVTOPTA3" # Build it!
		add_years_of_income = -1
		add_dip_power = 50
		add_mil_power = 50
		add_adm_power = 50
		add_innovativeness_big_effect = yes
	}
	option = {
		name = "flavor_tim.EVTOPTB3" # We don't have the time or the money for such foolishness!
		add_prestige = -5
	}
}

country_event = {
	id = flavor_tim.4
	title = "flavor_tim.0.t"
	desc = "flavor_tim.0.d"
	picture = OVEREXTENSION_eventPicture
	
	is_triggered_only = yes
	
	option = { 
		name = "flavor_tim.0.a" # My time has come!
		custom_tooltip = flavor_tim.0.a.tt
	}
}

country_event = {
	id = flavor_tim.5
	title = "flavor_tim.5.t"
	desc = "flavor_tim.5.d"
	picture = BATTLE_eventPicture
	
	is_triggered_only = yes
	major = yes
	major_trigger = {
		TIM_interested_in_persian_matter = yes
	}
	
	option = { 
		name = "flavor_tim.5.a"
		
		ai_chance = {
			factor = 1
		}
		
		add_country_modifier = {
			name = TIM_resolved_the_mushasha_milleniarism #increase ruler expectancy due to assassination concerns
			duration = 10950
		}
		
		khuzestan_area = {
			add_base_manpower = 1
		}
	}
}

country_event = {
	id = flavor_tim.6
	title = "flavor_tim.6.t"
	desc = "flavor_tim.6.d"
	picture = ECONOMY_eventPicture
	
	is_triggered_only = yes
	
	option = { 
		name = "flavor_tim.6.a"
		ai_chance = {
			factor = 1
		}
		custom_tooltip = TIM_upgrade_iqta_tax
		set_country_flag = TIM_upgrade_iqta_tax_flag		
		add_adm_power = 50
	}
	
	option = { 
		name = "flavor_tim.6.b"
		ai_chance = {
			factor = 1
		}
		custom_tooltip = TIM_upgrade_iqta_manpower
		set_country_flag = TIM_upgrade_iqta_manpower_flag
		add_mil_power = 50
	}
	
	option = { 
		name = "flavor_tim.6.c"
		ai_chance = {
			factor = 1
		}
		custom_tooltip = TIM_upgrade_iqta_ld
		set_country_flag = TIM_upgrade_iqta_ld_flag
		add_dip_power = 50
	}
}

country_event = {
	id = flavor_tim.7
	title = "flavor_tim.7.t"
	desc = "flavor_tim.7.d"
	picture = CONQUEST_eventPicture
	
	is_triggered_only = yes
	major = yes
	major_trigger = {
		TIM_interested_in_persian_matter = yes
	}
	
	option = { 
		name = "flavor_tim.7.a"
		ai_chance = {
			factor = 1
		}
		azerbaijan_region = {
			add_random_development = 1
			add_province_modifier = {
				name = TIM_conflict_with_qara_qoyunlu_over
				duration = 5475
			}
		}
	}
}

#flavor_tim.8 removed

country_event = {
	id = flavor_tim.9
	title = "flavor_tim.9.t"
	desc = "flavor_tim.9.d"
	picture = RELIGION_eventPicture
	
	is_triggered_only = yes
	
	option = { 
		name = "flavor_tim.9.a"
		ai_chance = {
			factor = 20
		}
		if = {
			limit = {
				NOT = {
					religious_school = {
						group = muslim
						school = hanbali_school
					}
				}
			}
			set_religious_school = {
				group = muslim
				school = hanbali_school
			}
		}
		else = { add_adm_power = 200 }		
		add_piety = -0.5
	}
	
	option = { 
		name = "flavor_tim.9.b" 
		ai_chance = {
			factor = 80
		}
		set_country_flag = TIM_religious_diplomats_hanbali
		if = {
			limit = {
				has_estate = estate_church
			}
			custom_tooltip = TIM_religious_diplomats_hanbali_tt			
			add_estate_loyalty = { estate = estate_church loyalty = 15 }
		}
		else = {
			add_stability_or_adm_power = yes
		}
	}
}

country_event = {
	id = flavor_tim.10
	title = "flavor_tim.10.t"
	desc = "flavor_tim.10.d"
	picture = RELIGION_eventPicture
	
	is_triggered_only = yes
	
	option = { 
		name = "flavor_tim.10.a"
		ai_chance = {
			factor = 1
		}
		custom_tooltip = TIM_revoking_yasa_will_be_easier
		set_country_flag = TIM_revoking_yasa_will_be_easier_flag
		add_legitimacy = 10	
		add_country_modifier = {
			name = TIM_a_pious_ruler
			duration = 10950
		}
	}
	
	option = { 
		name = "flavor_tim.10.b" 
		ai_chance = {
			factor = 0
		}
		custom_tooltip = TIM_soyurghals_will_be_less_penalizing
		set_country_flag = TIM_soyurghals_will_be_less_penalizing_flag
		add_country_modifier = {
			name = TIM_approval_of_governors
			duration = 9125
		}
		add_mil_power = 100
	}
}

country_event = {
	id = flavor_tim.11
	title = "flavor_tim.11.t"
	desc = "flavor_tim.11.d"
	picture = ECONOMY_eventPicture
	
	is_triggered_only = yes
	
	option = {
		name = flavor_tim.11.a
		
		ai_chance = {
			factor = 100
		}
		if = {
			limit = {
				OR = {
					has_dlc = "Res Publica"
					has_dlc = "Common Sense"
				}
			}
			custom_tooltip = TIM_unlock_timurid_diwan_reform
		}
		else = {
			custom_tooltip = unlock_government_reform_timurid_diwan_reform
		}
		hidden_effect = {
			unlock_government_reform = {
				government_reform = timurid_diwan_reform
			}
		}
		
		if = {
			limit = {
				NOT = { reform_level = 3 }
			}
			change_government_reform_progress = 100
		}
		else = {
			custom_tooltip = TIM_enact_timurid_diwan_reform
			hidden_effect = {
				add_government_reform = timurid_diwan_reform
			}
		}
	}
	
	option = {
		name = flavor_tim.11.b
		
		ai_chance = {
			factor = 0
		}
		
		trigger = {
			reform_level = 3
		}
		change_government_reform_progress = 50
		hidden_effect = {
			unlock_government_reform = {
				government_reform = timurid_diwan_reform
			}
		}
		
		custom_tooltip = TIM_unlock_timurid_diwan_reform
	}
}

country_event = {
	id = flavor_tim.12
	title = "flavor_tim.12.t"
	desc = "flavor_tim.12.d"
	picture = OVEREXTENSION_eventPicture
	
	is_triggered_only = yes
	hidden = yes
	
	immediate = {
		pick_best_provinces = {
			3 = yes
			global_trigger = "
				has_manpower_building_trigger = yes
			"
			scale = higher_development_than
			event_target_name = tim_target
			scope = every_owned_province
		}
	}
	
	option = {
		name = flavor_tim.12.a
		
		ai_chance = {
			factor = 1
		}
		
		event_target:tim_target_1 = {
			add_or_upgrade_manpower_building = yes
		}
		
		event_target:tim_target_2 = {
			add_or_upgrade_manpower_building = yes
		}
		
		event_target:tim_target_3 = {
			add_or_upgrade_manpower_building = yes
		}
	}
}

country_event = {
	id = flavor_tim.13
	title = "flavor_tim.13.t"
	desc = "flavor_tim.13.d"
	picture = OVEREXTENSION_eventPicture
	
	is_triggered_only = yes
	
	#AI section
	option = {
		trigger = {
			ai = yes
		}
		
		random_list = {
			1 = { set_country_flag = TIM_persian_missions clr_country_flag = TIM_nomad_missions }
			1 = { set_country_flag = TIM_nomad_missions clr_country_flag = TIM_persian_missions }
		}
		swap_non_generic_missions = yes
		select_current_missions = { key = TIM }
		ai_chance = {
			factor = 100
		}
	}
}

#flavor_tim.14 removed

country_event = {
	id = flavor_tim.15
	title = "flavor_tim.15.t"
	desc = "flavor_tim.15.d"
	picture = RELIGIOUS_TURMOIL_eventPicture
	
	is_triggered_only = yes
	
	
	option = {
		ai_chance = {
			factor = 100
		}
		name = flavor_tim.15.a
		
		change_primary_culture = persian
					
		custom_tooltip = TIM_will_be_necessary_to_form_persia
				 
		add_accepted_culture_or_dip_power = {
			culture = turkmeni
			dip_reward = yes
		}
	}
	
	option = {
		ai_chance = {
			factor = 0
		}
		name = flavor_tim.15.b
		
		add_country_modifier = {
			name = TIM_dev_cost_until_persia_formation
			duration = -1
			desc = TIM_until_persia
		}
	}
}

country_event = {
	id = flavor_tim.16
	title = "flavor_tim.16.t"
	desc = "flavor_tim.16.d"
	picture = TRADEGOODS_eventPicture
	
	is_triggered_only = yes
	
	
	option = {
		ai_chance = {
			factor = 50
		}
		name = flavor_tim.16.a
		add_country_modifier = {
			name = TIM_internal_benefits
			duration = -1
		}
		add_adm_power = 100		
		custom_tooltip = TIM_distribute_15_dev_amongst_trade_centers
		hidden_effect = {
			for = {
				amount = 15
				effect = "
					random_owned_province = {
						limit = { province_has_center_of_trade_of_level = 1 }
						add_random_development = 1
					}
				"
			}
		}
	}
	
	option = {
		ai_chance = {
			factor = 50
		}
		name = flavor_tim.16.b
		add_country_modifier = {
			name = TIM_external_benefits
			duration = -1
		}
		add_dip_power = 100		
		custom_tooltip = TIM_gain_1_yearly_manpower_per_soyurghal_we_have
		hidden_effect ={
			every_subject_country = {
				limit = {
					is_subject_of_type = soyurghal_subject_type
				}
				ROOT = { add_yearly_manpower = 1 }
			}
		}
	}
}

country_event = {
	id = flavor_tim.17
	title = "flavor_tim.17.t"
	desc = "flavor_tim.17.d"
	picture = BAD_WITH_MONARCH_eventPicture
	
	mean_time_to_happen = {
		months = 12
	}
	
	fire_only_once = yes
	
	trigger = {
		tag = FRS 
		is_subject_of = TIM
		NOT = { liberty_desire = 50 }
		has_ruler = "Mu'izz al-Din Malik"
		NOT = { is_year = 1450 }
	}
	
	option = {
		ai_chance = {
			factor = 1
		}
		name = flavor_tim.17.a
		add_prestige = -5
		
		TIM = {
			country_event = { id = flavor_tim.18 }
		}
	}
}

country_event = {
	id = flavor_tim.18
	title = "flavor_tim.18.t"
	desc = "flavor_tim.18.d"
	picture = BAD_WITH_MONARCH_eventPicture
	
	is_triggered_only = yes
	major = yes
	major_trigger = {
		OR = {
			tag = QOM 
			is_subject_of = TIM
			is_rival = TIM 
			is_enemy = TIM 
			is_neighbor_of = TIM
		}
	}
	
	immediate = {
		hidden_effect = {
			define_exiled_ruler = {
				exiled_as = FRS_candidate_1
				min_age = 20
				max_age = 50
				change_dip = -2
				change_mil = -2
				change_adm = 1
				option = 0
			}
			define_exiled_ruler = {
				exiled_as = FRS_candidate_2
				min_age = 20
				max_age = 50
				change_adm = -2
				change_mil = -2
				change_dip = 1
				option = 1
			}
			define_exiled_ruler = {
				exiled_as = FRS_candidate_3
				min_age = 20
				max_age = 50
				change_dip = -2
				change_adm = -2
				change_mil = 1
				option = 2
			}
			define_exiled_ruler = {
				exiled_as = FRS_candidate_4
				min_age = 20
				max_age = 50
				change_dip = -1
				change_mil = -1
				change_adm = -1
				option = 3
			}
			define_exiled_ruler = {
				exiled_as = FRS_candidate_5
				min_age = 50
				change_dip = 1
				change_mil = 1
				change_adm = 1
				option = 4
			}
		}
	}
	
	option = {
		ai_chance = {
			factor = 1
		}
		name = flavor_tim.18.a
		FRS = {
			set_ruler = FRS_candidate_1
		}		
		custom_tooltip = FRS_color_will_change
		hidden_effect = {
			FRS = {
				change_country_color = { color = { 79 0 185 } }
			}
		}
	}
	
	option = {
		ai_chance = {
			factor = 1
		}
		name = flavor_tim.18.b
		FRS = {
			set_ruler = FRS_candidate_2
		}
		custom_tooltip = FRS_color_will_change
		hidden_effect = {
			FRS = {
				change_country_color = { color = { 254 197 229 } }
			}
		}
	}
	
	option = {
		ai_chance = {
			factor = 1
		}
		name = flavor_tim.18.c
		FRS = {
			set_ruler = FRS_candidate_3
		}
		custom_tooltip = FRS_color_will_change
		hidden_effect = {
			FRS = {
				change_country_color = { color = { 0 62 107 } }
			}
		}
	}
	
	option = {
		ai_chance = {
			factor = 1
		}
		name = flavor_tim.18.e
		FRS = {
			set_ruler = FRS_candidate_4
		}
		custom_tooltip = FRS_color_will_change
		hidden_effect = {
			FRS = {
				change_country_color = { color = { 232 206 0 } }
			}
		}
	}
	
	option = {
		ai_chance = {
			factor = 1
		}
		name = flavor_tim.18.g
		FRS = {
			set_ruler = FRS_candidate_5
		}
		custom_tooltip = FRS_color_will_change
		hidden_effect = {
			FRS = {
				change_country_color = { color = { 100 255 200 } }
			}
		}
	}
	
	option = {
		ai_chance = {
			factor = 1
		}
		name = flavor_tim.18.f
	}
}

#flavor_tim.19 - 20 removed

country_event = {
	id = flavor_tim.21
	title = "flavor_tim.21.t"
	desc = "flavor_tim.21.d"
	picture = COUNTRY_COLLAPSE_eventPicture
	
	fire_only_once = yes
	
	mean_time_to_happen = {
		months = 6
	}
	
	major = yes
	major_trigger = {
		TIM_interested_in_persian_matter = yes
	}
	
	trigger = {
		exists = QOM
		NOT = { war_with = QOM }
		tag = TIM
		is_year = 1445
	}
	
	option = {
		ai_chance = {
			factor = 1
			modifier = {
				factor = 0
				QOM = { ai = no }
			}
		}
		name = flavor_tim.21.a
		declare_war_with_cb = {
			who = QOM
			casus_belli = cb_tim_crush_rebellion
			war_goal_province = 7554
		}
		custom_tooltip = TIM_cb_benefits
		add_years_of_income = -0.5		
		add_yearly_manpower = -0.25 
	}
	
	option = {
		ai_chance = {
			factor = 1
		}
		name = flavor_tim.21.b
		add_prestige = -10
	}
}